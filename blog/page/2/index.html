
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>alanthing</title>
  <meta name="author" content="Alan Ivey">

  
  <meta name="description" content="At EchoDitto, we get a lot of questions about how hosting works, and in particular about changing DNS records for new websites or websites who are &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://alanthing.com/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="alanthing" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34327970-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">alanthing</a></h1>
  
    <h2>Linux and other things</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alanthing.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/29/can-i-get-your-number-dns-made-simple/">Can I Get Your Number? DNS Made Simple</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-29T09:51:00-05:00" pubdate data-updated="true">Feb 29<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At <a href="http://www.echoditto.com">EchoDitto</a>, we get a lot of questions about how hosting works, and in particular about changing DNS records for new websites or websites who are moving to new hosting providers. Here&rsquo;s an old but true analogy to make understanding DNS easier: the IP address of your website is like your phone number (it changes if you move houses &ndash; at least, your landline does), and DNS is like the phonebook. If someone wants to call you at your new house they might look you up by name in the phonebook, but if their phonebook hasn&rsquo;t been updated since you moved they&rsquo;re going to call your old house.</p>

<p>Here&rsquo;s how it works in more detail:</p>

<p>When visitors want to access your website their computers take the domain name that they type in (echoditto.com, for example) and look up the IP address for that domain by way of Domain Name Service, or DNS.</p>

<p>To get your DNS records for users to get to your website, first you need a domain name. Go Daddy and Network Solutions are examples of registrars where you can buy domain names.</p>

<p>Continuing the analogy, the first thing a visitor&rsquo;s computer needs to know is which &ldquo;phonebook&rdquo; your website&rsquo;s IP address is listed in. The registrar will set something called the &ldquo;name server&rdquo; for your domain, which is akin to telling the user which &ldquo;phonebook&rdquo; (name server) to look you up in. The name server contains the details about how your domain name, example.com, will get to the computer that actually contains (or &ldquo;hosts&rdquo;) your website.</p>

<p>In a phonebook, you look up a name and get a phone number. It&rsquo;s similar with DNS &ndash; the user&rsquo;s computer will look up your domain in the name server and get an IP address, which is a numerical address of a computer on the internet. The name server gives the user&rsquo;s computer the exact IP address of the computer that hosts your website. Once it has that information the user&rsquo;s computer can &ldquo;call&rdquo; the number,  which takes them directly to your website.</p>

<p>DNS contains another field along with the IP address, called a TTL, or time-to-live. This time, in seconds, is how long your computer should remember the number in the phonebook before it looks it up again. Computers check in with DNS name servers before visiting a site again to make sure the IP address of a website hasn&rsquo;t changed, and the TTL tells them how often to do that. TTL times can vary, but often you may find it initially set for 1 to 4 hours on average websites. The higher the setting is, the less often the DNS name server will be asked about the IP address and other DNS records.</p>

<p>When launching a website on a new server, or moving web hosts, you want to temporarily change the TTL to be really low. That makes website visitors check their &ldquo;phonebook&rdquo; more frequently, which means they will stop going to the old IP address as soon as possible after a change is made. It can take a while for a new TTL to take effect for all users if using the typical defaults of 1 to 4 hours, so when we&rsquo;re launching a new site, or changing hosting, we do this ahead of time. Once visitors worldwide have the new lower TTL, we can change the DNS entry for the website to point to the new IP address, and then visitors will see your new website, or your current website on the new host, very quickly.</p>

<p>Have other questions about DNS? Ask your computer to look up <a href="http://www.youtube.com/watch?v=oN7ripK5uGM">http://www.youtube.com/watch?v=oN7ripK5uGM</a> to watch a video that explains all of this in another way.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/10/nodejs-and-npm-centos/">Node.js and NPM on CentOS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-10T17:23:00-05:00" pubdate data-updated="true">Feb 10<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong><em>Update:</em> This no longer appears to be necessary as of nodejs 0.8.0.</strong> It may have been fixed earlier but I noticed neither of these changes are necessary anymore. Something new though, I had problems with node-gyp, and the solution was to install python26 with yum and then re-run the npm command with <code>PYTHON="/usr/bin/python26" npm install -deps</code> or similar.</p>

<p>The preferred way to install node and NPM seems to be installing from source, but I&rsquo;m a perennial fan of using packages to keep things tidy, especially if I need to uninstall something. I started by going to the <a href="http://nodejs.org/#download">Node.js download page</a>, and through to <a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">Installing with a package manager</a>. I installed the yum release RPM for the <a href="http://nodejs.tchol.org/">tchol.org</a> repository as directed and installed <strong>nodejs</strong> and <strong>npm</strong> with yum. From there, I ran into two problems but thankfully they were fairly easy to resolve.</p>

<p>The first thing I wanted to do was install <a href="https://github.com/nodejitsu/forever">forever</a> globally so I could use it to keep applications running persistently. But running <code>npm install forever -g</code> kept stalling. The npm RPM installed from the tchol.org repository creates the symlink /usr/lib/node_modules to /usr/lib/nodejs. That&rsquo;s fine, but /usr/lib/nodejs is owned by root:root. Running a npm install command with sudo attempted to set the ownership of the NPM modules as nobody:user, and NPM wasn&rsquo;t exiting due to permissions for some reason.</p>

<p>I have ACLs enabled on my file system, so I fixed this by allowing nobody write access to /usr/lib/nodejs:</p>

<pre><code>sudo setfacl -m u:nobody:rwx /usr/lib/nodejs
</code></pre>

<p>If you don&rsquo;t have ACLs enabled on your filesystem, you could allow nobody to be the folder owner:</p>

<pre><code>sudo chown nobody:nobody /usr/lib/nodejs
</code></pre>

<p>The second problem I ran into was, after installing forever, it wouldn&rsquo;t run. The nodejs package installed the binary as /usr/bin/nodejs but /usr/bin/forever begins with <strong>#!/usr/bin/env node</strong>, which will not return a valid interpreter. I wanted to install a symlink into /usr/local/bin, but some users don&rsquo;t always have that in their path, so I created a link via:</p>

<pre><code>sudo ln -s /usr/bin/nodejs /usr/bin/node
</code></pre>

<p>Now I&rsquo;m able to install anything I need to with NPM and run my Node.js applications with Forever. I&rsquo;m still very new to Node, so if you think I should be doing things a better way, let me know in the comments!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/30/alans-2011-favorites/">Alan&#8217;s 2011 Favorites</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-30T17:00:00-05:00" pubdate data-updated="true">Jan 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Favorite Links of 2011</h2>

<p><a href="http://www.google.com/reader">Google Reader</a> &ndash; between the Android app, Reeder for iPad, and the website, keeps me up to date on the news.</p>

<p><a href="http://stackoverflow.com/">Stack Overflow</a> and other Stack Exchange sites &ndash; one of the best ways to get help and help others.</p>

<p><a href="http://9gag.com/">9GAG</a> &ndash; thanks to (our summer intern) Vicky for showing this to me, I waste a lot of time looking at internet memes.</p>

<h2>Best Entertainment of 2011</h2>

<p><a href="http://www.nbc.com/friday-night-lights/">Friday Night Lights</a> &ndash; the final season was aired on NBC in the first half of the year. It gets my vote for the best drama of all time.</p>

<p><a href="http://www.nbc.com/community/">Community</a> &ndash; one of the smartest and most brilliant comedies in recent memory. It&rsquo;s a shame NBC doesn&rsquo;t get it and has decided to &ldquo;bench&rdquo; it for the immediate future. It doesn&rsquo;t get good Nielson rating because a majority of their audience watches it on Netflix/Hulu/DVR/etc.</p>

<p><a href="http://www.imdb.com/title/tt0800369/">Thor</a> &ndash; it won&rsquo;t win any awards for best screenplay, but 1) it was a beautiful movie with great special effects, and 2) the closer we get to an Avengers movie, the more this geek gets excited!</p>

<h2>Favorite Restaurant</h2>

<p><a href="http://www.rachelscreperie.com">Rachel&rsquo;s Creperie</a> &ndash; at the end of the block of my new co-working space, offers a new way to try many kinds of foods you&rsquo;d normally just slap in between two pieces of boring bread.</p>

<h2>Favorite Game</h2>

<p><a href="http://youtube.com/watch?v=lPVgqEd8noA">Farkle!</a> &ndash; the link explains all of the rules.  All it requires is 6 dice and 1 or more friends. It channels Yahtzee but has some fun twists.</p>

<h2>Favorite Mobile App</h2>

<p><a href="http://www.wordswithfriends.com/">Words With Friends</a> &ndash; I know it&rsquo;s more like the game of 2010, but this year they added the Android version so I can play Facebook and iPhone friends, and it gives my brain a quick puzzle when I have some downtime.</p>

<h2>Favorite Technology Innovation</h2>

<p>Music in the Cloud, either <a href="http://music.google.com/about/">Google Music</a>, <a href="http://www.amazon.com/b?ie=UTF8&amp;node=2658409011">Amazon Cloud Player</a>, or <a href="https://www.icloud.com/">iCloud</a> &ndash; they make listening to the same music on my laptop and my phone a snap. Sync-less bliss&hellip;</p>

<h2>Favorite Cause</h2>

<p>It wasn&rsquo;t new to 2011, but I think 2011 is when <a href="http://kickstarter.com">Kickstarter</a> really became huge. It&rsquo;s amazing to see peoples&#8217; dreams come to life.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/11/os-x-107-lion-development-macports/">OS X 10.7 Lion Development: MacPorts</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-11T14:13:00-04:00" pubdate data-updated="true">Oct 11<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>OS X Lion comes with most of the tools you would need to do &ldquo;MAMP&rdquo; (Mac OS X, Apache, MySQL/MariaDB, PHP) development, as outlined in my <a href="http://echodittolabs.org/blog/2011/08/os-x-107-lion-development-native-mamp-mysql-installer">previous</a> <a href="http://echodittolabs.org/blog/2011/09/os-x-107-lion-development-native-apache-php-homebrew-mysql-or-mariadb">posts</a> once you add a database. So then why would you want to use MacPorts? Setting your development environment up in MacPorts isolates the binaries, libraries, and configuration files, completely separate from the existing OS X install (with the exception of startup scripts). You can also tweak the configuration files on your own, apply your own patches, and apply updates that MacPorts may get before Apple pushes them. It will take more time because you&rsquo;ll be compiling everything, but you have all of the control. Read on for how to get things set up.</p>

<h2>Prerequisites</h2>

<p>We&rsquo;ll going to be compiling a lot of source code so you&rsquo;ll need to have <a href="http://itunes.apple.com/us/app/xcode/id448457090">Xcode 4</a> installed. I initially tried with the <a href="https://github.com/kennethreitz/osx-gcc-installer">OS X GCC Installer</a> but eventually ran into a problem where a portfile was expecting an Xcode binary to check to a prerequisite. I&rsquo;m sure some hacking could&rsquo;ve resolved it to avoid having to install the very large Xcode package, but at the end of the day it&rsquo;s better to just know that it&rsquo;ll work as expected.</p>

<p>Once you have Xcode 4 installed, you&rsquo;ll need to <a href="http://www.macports.org/install.php">install MacPorts</a>. It&rsquo;s a simple click-through installer. Come back to this guide once MacPorts is ready.</p>

<p>Note that for all commands before that are starting with a $, the dollar sign is showing a command-line prompt in <a href="http://www.apple.com/macosx/apps/all.html#terminal">Terminal</a>, and you should not actually type it as part of the commands.</p>

<h2>Install packages</h2>

<p>Update the ports tree to get the latest from the MacPorts server in case the installer had an older tree:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /opt/local/bin/port selfupdate
</span></code></pre></td></tr></table></div></figure>


<p>All of the packages that we need can be installed with a single command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /opt/local/bin/port install apache2 php5 php5-mysql mysql5-server php5-gd php5-mbstring php5-apc lynx phpmyadmin
</span></code></pre></td></tr></table></div></figure>


<p>Compiling all of these tools will take a while, so grab a book and come back when the command is completed.</p>

<h2>Configure PHP</h2>

<p>The following will set up PHP with some development-friendly settings.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo cp -av /opt/local/etc/php5/php.ini-development /opt/local/etc/php5/php.ini
</span><span class='line'><span class="nv">$ </span>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/\(default_socket[ ]\{0,1\}=\)/\1 \/opt\/local\/var\/run\/mysql5\/mysqld.sock/g&#39;</span> /opt/local/etc/php5/php.ini
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /opt/local/etc/php5/php.ini &lt;&lt;&#39;EOF&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">;; User customizations below</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">; Original - memory_limit = 128M</span>
</span><span class='line'><span class="s2">memory_limit = 196M</span>
</span><span class='line'><span class="s2">; Original - post_max_size = 8M</span>
</span><span class='line'><span class="s2">post_max_size = 200M</span>
</span><span class='line'><span class="s2">; Original - upload_max_filesize = 2M</span>
</span><span class='line'><span class="s2">upload_max_filesize = 100M</span>
</span><span class='line'><span class="s2">; Original - default_socket_timeout = 60</span>
</span><span class='line'><span class="s2">default_socket_timeout = 600</span>
</span><span class='line'><span class="s2">; Original - max_execution_time = 30</span>
</span><span class='line'><span class="s2">max_execution_time = 300</span>
</span><span class='line'><span class="s2">; Original - max_input_time = 60</span>
</span><span class='line'><span class="s2">max_input_time = 600</span>
</span><span class='line'><span class="s2">; Original - ;date.timezone =</span>
</span><span class='line'><span class="s2">date.timezone = &#39;America/New_York&#39;</span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now configure the APC extension (installed above with php5-apc) which will increase PHP performance dramatically.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt; /opt/local/var/db/php5/apc-config.ini &lt;&lt;&#39;EOF&#39;</span>
</span><span class='line'><span class="s2">[apc]</span>
</span><span class='line'><span class="s2">apc.enabled = 1</span>
</span><span class='line'><span class="s2">apc.shm_segments = 1</span>
</span><span class='line'><span class="s2">apc.shm_size = 96M</span>
</span><span class='line'><span class="s2">apc.cache_by_default = 1</span>
</span><span class='line'><span class="s2">apc.stat = 1</span>
</span><span class='line'><span class="s2">apc.rfc1867 = 1</span>
</span><span class='line'><span class="s2">apc.stat = 7200</span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Configure Apache</h2>

<p>Start by setting up PHP to work with Apache properly:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo cp -av /opt/local/apache2/conf/httpd.conf /opt/local/apache2/conf/httpd.conf-default
</span><span class='line'><span class="nv">$ </span>sudo /opt/local/apache2/bin/apxs -a -e -n <span class="s2">&quot;php5&quot;</span> /opt/local/apache2/modules/libphp5.so
</span><span class='line'><span class="nv">$ </span>sudo bash -c <span class="s2">&quot;cat &gt;&gt; /opt/local/apache2/conf/httpd.conf &lt;&lt;&#39;EOF&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">## Add mod_php information</span>
</span><span class='line'><span class="s2">Include conf/extra/mod_php.conf</span>
</span><span class='line'><span class="s2"># Add index.php to the list of files that will be served as directory indexes.</span>
</span><span class='line'><span class="s2">&lt;IfModule dir_module&gt;</span>
</span><span class='line'><span class="s2">  DirectoryIndex index.php index.html</span>
</span><span class='line'><span class="s2">&lt;/IfModule&gt;</span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we&rsquo;ll move httpd-vhosts.conf to ~/Sites for easy editing of new virtual hosts, as well as create a ~/Sites/logs folder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo mv -v /opt/local/apache2/conf/extra/httpd-vhosts.conf /opt/local/apache2/conf/extra/httpd-vhosts.conf-default &lt;/br&gt;
</span><span class='line'><span class="nv">$ </span><span class="o">[</span> ! -d ~/Sites <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir -v ~/Sites
</span><span class='line'><span class="nv">$ </span>cp -av /opt/local/apache2/conf/extra/httpd-vhosts.conf-default ~/Sites/httpd-vhosts.conf
</span><span class='line'><span class="nv">$ </span>sudo ln -s ~/Sites/httpd-vhosts.conf /opt/local/apache2/conf/extra/httpd-vhosts.conf
</span><span class='line'><span class="nv">$ </span>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/\#\(.*httpd-vhosts\.conf\)/\1/&#39;</span> /opt/local/apache2/conf/httpd.conf
</span><span class='line'><span class="nv">$ </span><span class="o">[</span> ! -d ~/Sites/logs <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir ~/Sites/logs
</span><span class='line'><span class="nv">$ </span>sudo perl -pi -e <span class="s1">&#39;BEGIN{undef $/;} s/\&lt;VirtualHost .*\n//sg;&#39;</span> <span class="k">${</span><span class="nv">USERHOME</span><span class="k">}</span>/Sites/httpd-vhosts.conf &lt;/br&gt;
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; ~/Sites/httpd-vhosts.conf &lt;&lt;&#39;EOF&#39; &lt;/br&gt;</span>
</span><span class='line'><span class="s2"> &lt;/br&gt;</span>
</span><span class='line'><span class="s2">## Change /Users/name to the path of your home folder &lt;/br&gt;</span>
</span><span class='line'><span class="s2">#&lt;VirtualHost *:80&gt; &lt;/br&gt;</span>
</span><span class='line'><span class="s2">#  ServerName project.local &lt;/br&gt;</span>
</span><span class='line'><span class="s2">#  CustomLog &quot;</span>/Users/name/Sites/logs/project.local-access_log<span class="s2">&quot; combined &lt;/br&gt;</span>
</span><span class='line'><span class="s2">#  ErrorLog &quot;</span>/Users/name/Sites/logs/project.local-error_log<span class="s2">&quot; &lt;/br&gt;</span>
</span><span class='line'><span class="s2">#  DocumentRoot &quot;</span>/Users/name/Sites/project.local<span class="s2">&quot; &lt;/br&gt;</span>
</span><span class='line'><span class="s2">#&lt;/VirtualHost&gt; &lt;/br&gt;</span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Allow userdirs so the MacPorts Apache &ldquo;feels&rdquo; more like the built-in Apache:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/\#\(.*httpd-userdir\.conf\)/\1/&#39;</span> /opt/local/apache2/conf/httpd.conf
</span></code></pre></td></tr></table></div></figure>


<p>Start Apache and set it to load on boot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /opt/local/bin/port load apache2
</span></code></pre></td></tr></table></div></figure>


<h2>Configure MySQL</h2>

<p>Set up the configuration file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo cp -av /opt/local/share/mysql5/mysql/my-small.cnf /opt/local/etc/mysql5/my.cnf
</span><span class='line'>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/max_allowed_packet = 1.*M/max_allowed_packet = 1G/g&#39;</span> /opt/local/etc/mysql5/my.cnf
</span></code></pre></td></tr></table></div></figure>


<p>Initialize MySQL and run the secure installation script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo -u _mysql /opt/local/bin/mysql_install_db5
</span><span class='line'>sudo /opt/local/bin/port load mysql5-server
</span><span class='line'>sudo /opt/local/lib/mysql5/bin/mysql_secure_installation
</span></code></pre></td></tr></table></div></figure>


<h2>Configure phpMyAdmin</h2>

<p>Add a config file for Apache and reload Apache:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /opt/local/apache2/conf/httpd.conf &lt;&lt;&#39;EOF&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s2"># phpMyAdmin</span>
</span><span class='line'><span class="s2">Include conf/extra/phpmyadmin.conf</span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /opt/local/apache2/conf/extra/phpmyadmin.conf &lt;&lt;&#39;EOF&#39;</span>
</span><span class='line'><span class="s2">AliasMatch ^/phpmyadmin(?:/)?(/.*)?$ /opt/local/www/phpmyadmin$1</span>
</span><span class='line'><span class="s2">AliasMatch ^/phpMyAdmin(?:/)?(/.*)?$ /opt/local/www/phpmyadmin$1</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;Directory &quot;</span>/opt/local/www/phpmyadmin<span class="s2">&quot;&gt;</span>
</span><span class='line'><span class="s2"> Options -Indexes</span>
</span><span class='line'><span class="s2"> AllowOverride None</span>
</span><span class='line'><span class="s2"> Order allow,deny</span>
</span><span class='line'><span class="s2"> Allow from all</span>
</span><span class='line'>
</span><span class='line'><span class="s2"> LanguagePriority en de es fr ja ko pt-br ru</span>
</span><span class='line'><span class="s2"> ForceLanguagePriority Prefer Fallback</span>
</span><span class='line'><span class="s2">&lt;/Directory&gt;</span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span><span class='line'><span class="nv">$ </span>sudo /opt/local/bin/port unload apache2
</span><span class='line'><span class="nv">$ </span>sudo /opt/local/bin/port load apache2
</span></code></pre></td></tr></table></div></figure>


<p>Basic set up of phpMyAdmin:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s2">&quot;s/blowfish_secret\&#39;\] = \&#39;/blowfish_secret\&#39;\] = \&#39;`cat /dev/urandom | strings | grep -o &#39;[[:alnum:]]&#39; | head -n 50 | tr -d &#39;\n&#39;`/&quot;</span> /opt/local/www/phpmyadmin/config.inc.php
</span><span class='line'>sudo /opt/local/bin/mysql5 -uroot -proot &lt; /opt/local/www/phpmyadmin/scripts/create_tables.sql
</span><span class='line'>sudo /opt/local/bin/mysql5 -uroot -proot -e<span class="s2">&quot;CREATE USER &#39;pma&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;pmapass&#39;; GRANT SELECT, INSERT, DELETE, UPDATE ON phpmyadmin.* TO pma@localhost;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Hooray!</h2>

<p>Now you can edit ~/Sites/httpd-vhosts.conf and add a new virtual host. You&rsquo;d need to reload Apache after doing so by running <code>sudo port unload apache2 &amp;&amp; sudo port load apache2</code>. phpMyAdmin or the mysql5 binary should provide you a way to create new databases and database users and you can then set up a local site.</p>

<p>If you find MacPorts too heavy a separation from OSX, or too slow to compile, you should check out my previous blog posts on setting up a MAMP environment with as many built-in tools as possible only by adding a <a href="http://echodittolabs.org/blog/2011/08/os-x-107-lion-development-native-mamp-mysql-installer">MySQL installer</a> or <a href="http://echodittolabs.org/blog/2011/09/os-x-107-lion-development-native-apache-php-homebrew-mysql-or-mariadb">MySQL/MariaDB via Homebrew</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/09/07/os-x-107-lion-development-native-apache-php-homebrew-mysql-or-mariadb/">OS X 10.7 Lion Development: Native Apache & PHP With Homebrew MySQL or MariaDB</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-07T17:45:00-04:00" pubdate data-updated="true">Sep 7<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>OS X Lion ships with Apache and PHP, which both require a little bit of tweaking to get fully-functional for &ldquo;MAMP&rdquo; local development. The one thing Lion does not ship with is a database. This will be very similar to my <a href="http://echodittolabs.org/blog/2011/08/os-x-107-lion-development-native-mamp-mysql-installer">previous post on local development</a> but this time we&rsquo;ll be using Homebrew to install either MySQL or MariaDB for the database. Since we&rsquo;ll be using a compiler for Homebrew, I&rsquo;ll also cover how to add APC and other PECL modules that you can add to OS X.</p>

<p>Note that for all commands before that are starting with a $, the dollar sign is showing a command-line prompt in <a href="http://www.apple.com/macosx/apps/all.html#terminal">Terminal</a>, and you should not actually type it as part of the commands.</p>

<h2>Apache</h2>

<p>We&rsquo;ll set things up so we won&rsquo;t need sudo often in the future, and so we can manage multiple VirtualHosts. We&rsquo;ll keep the Apache information and our website roots in ~/Sites, and Apache logs in ~/Sites/logs</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span> ! -d ~/Sites <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir ~/Sites
</span><span class='line'>touch ~/Sites/httpd-vhosts.conf
</span><span class='line'>sudo ln -s ~/Sites/httpd-vhosts.conf /etc/apache2/other
</span><span class='line'>mkdir ~/Sites/logs
</span><span class='line'>chmod 0777 ~/Sites/logs
</span></code></pre></td></tr></table></div></figure>


<p>Edit the new <strong>~/Sites/httpd-vhosts.conf</strong> file and add the following. Note that you&rsquo;ll need to change all instances of &ldquo;/Users/name&rdquo; to your actual home folder path.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Use name-based virtual hosting. </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="nb">NameVirtualHost</span> *:80
</span><span class='line'>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Set up permissions for VirtualHosts in ~/Sites </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="nt">&lt;Directory</span> <span class="s">&quot;/Users/name/Sites&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nb">Options</span> Indexes FollowSymLinks MultiViews
</span><span class='line'>    <span class="nb">AllowOverride</span> <span class="k">All</span>
</span><span class='line'>    <span class="nb">Order</span> allow,deny
</span><span class='line'>    <span class="nb">Allow</span> from <span class="k">all</span>
</span><span class='line'><span class="nt">&lt;/Directory&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># For http://localhost in the OS X default location </span>
</span><span class='line'><span class="nt">&lt;VirtualHost</span> <span class="s">_default_:80</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nb">ServerName</span> localhost
</span><span class='line'>    <span class="nb">DocumentRoot</span> <span class="sx">/Library/WebServer/Documents</span>
</span><span class='line'><span class="nt">&lt;/VirtualHost&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># VirtualHosts below </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'>
</span><span class='line'><span class="c">## Template </span>
</span><span class='line'><span class="c">#&lt;VirtualHost *:80&gt; </span>
</span><span class='line'><span class="c">#    ServerName domain.local </span>
</span><span class='line'><span class="c">#    CustomLog &quot;/Users/name/Sites/logs/domain.local-access_log&quot; combined </span>
</span><span class='line'><span class="c">#    ErrorLog &quot;/Users/name/Sites/logs/domain.local-error_log&quot; </span>
</span><span class='line'><span class="c">#    DocumentRoot &quot;/Users/name/Sites/domain.local&quot; </span>
</span><span class='line'><span class="c">#&lt;/VirtualHost&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Launch <strong>System Preferences</strong> and go to <strong>Sharing</strong> and toggle <strong>Web Sharing</strong> off and on so it&rsquo;s started and reloaded with the new settings. Then click on the blue underlined link under <em>&ldquo;Your computer&rsquo;s website is available at this address:&rdquo;</em> to ensure Apache is working correctly, and you should see text saying &ldquo;It works!&rdquo;</p>

<p>To add a site, duplicate the &lt;VirtualHost&gt; section under the Template, remove the comments, and edit appropriately. Edit /etc/hosts (or use <a href="http://code.google.com/p/gmask/">Gas Mask</a>) and add an entry for 127.0.0.1 for your project.local, and make the appropriate change in the conf file, along with the correct DocumentRoot and Log file locations. See <a href="http://httpd.apache.org/docs/2.2/vhosts/name-based.html">Apache&rsquo;s documentation</a> for more information.</p>

<h2>PHP</h2>

<p>OS X has shipped with PHP for quite some time, but not had it enabled by default. We&rsquo;ll enable mod_php for Apache, and also set up an /etc/php.ini file based on the default one shipped with Lion with some development-friendly changes. Change your timezone as needed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;grep php /etc/apache2/httpd.conf|grep LoadModule|cut -d&#39;#&#39; -f2 &gt; /etc/apache2/other/php5-loadmodule.conf&quot;</span>
</span><span class='line'><span class="nv">$ </span>sudo cp -a /etc/php.ini.default /etc/php.ini
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /etc/php.ini &lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s2">;; </span>
</span><span class='line'><span class="s2">;; User customizations below </span>
</span><span class='line'><span class="s2">;; </span>
</span><span class='line'>
</span><span class='line'><span class="s2">; Original - memory_limit = 128M </span>
</span><span class='line'><span class="s2">memory_limit = 196M </span>
</span><span class='line'><span class="s2">; Original - post_max_size = 8M </span>
</span><span class='line'><span class="s2">post_max_size = 200M </span>
</span><span class='line'><span class="s2">; Original - upload_max_filesize = 2M </span>
</span><span class='line'><span class="s2">upload_max_filesize = 100M </span>
</span><span class='line'><span class="s2">; Original - default_socket_timeout = 60 </span>
</span><span class='line'><span class="s2">default_socket_timeout = 600 </span>
</span><span class='line'><span class="s2">; Original - max_execution_time = 30 </span>
</span><span class='line'><span class="s2">max_execution_time = 300 </span>
</span><span class='line'><span class="s2">; Original - max_input_time = 60 </span>
</span><span class='line'><span class="s2">max_input_time = 600 </span>
</span><span class='line'><span class="s2">; Original - display_errors = Off </span>
</span><span class='line'><span class="s2">display_errors = on </span>
</span><span class='line'><span class="s2">; Original - display_startup_errors = Off </span>
</span><span class='line'><span class="s2">display_startup_errors = on </span>
</span><span class='line'><span class="s2">; Original - ;date.timezone = </span>
</span><span class='line'><span class="s2">date.timezone = &#39;America/New_York&#39; </span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Optional:</strong> Lion ships with PEAR but not installed, whereas Snow Leopard it was installed. This will install PEAR from the phar archive, upgrade it, and add &lsquo;pear&rsquo; and &lsquo;pecl&rsquo; aliases to your shell.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /usr/bin/php /usr/lib/php/install-pear-nozlib.phar
</span><span class='line'><span class="nv">$ </span>cat &gt;&gt; ~/.bashrc <span class="s">&lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'>
</span><span class='line'><span class="s">alias pear=&quot;php /usr/lib/php/pear/pearcmd.php&quot; </span>
</span><span class='line'><span class="s">alias pecl=&quot;php /usr/lib/php/pear/peclcmd.php&quot; </span>
</span><span class='line'><span class="s">EOF</span>
</span><span class='line'><span class="nv">$ </span>. ~/.bashrc
</span><span class='line'><span class="nv">$ </span>sudo pear channel-update pear.php.net
</span><span class='line'><span class="nv">$ </span>sudo pecl channel-update pecl.php.net
</span><span class='line'><span class="nv">$ </span>sudo pear upgrade --force pear
</span><span class='line'><span class="nv">$ </span>sudo pear upgrade
</span><span class='line'><span class="nv">$ </span>sudo pecl upgrade
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /etc/php.ini &lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'><span class="s2">; Original - ;include_path = &quot;</span>.:/php/includes<span class="s2">&quot; </span>
</span><span class='line'><span class="s2">include_path = &quot;</span>.:/usr/lib/php/pear<span class="s2">&quot; </span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll cover APC and other PECL modules after we have Homebrew up and running.</p>

<p>Toggle <strong>Web Sharing</strong> in <strong>System Preferences &gt; Sharing</strong> for the new PHP options to take effect.</p>

<h2>Homebrew</h2>

<p>Hop onto the Mac App Store and download Xcode 4. It&rsquo;s free! When it&rsquo;s finished downloading, you&rsquo;ll have an Application called <strong>Install Xcode</strong> in the Applications folder, so run that and click through and you&rsquo;ll be all set. If it seems like overkill since we&rsquo;re not covering iOS or Mac app development, Xcode ships with the compiler we need for Homebrew and installing PECL modules.</p>

<p>To install Homebrew, go to <a href="https://github.com/mxcl/homebrew/wiki/installation">https://github.com/mxcl/homebrew/wiki/installation</a> and run the ruby script in Terminal. If you get the error message: <em>Error: Cannot write to /usr/local</em>, run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo chmod g+w /usr/local
</span><span class='line'>sudo chgrp staff /usr/local
</span></code></pre></td></tr></table></div></figure>


<h2>MariaDB / MySQL</h2>

<p><a href="http://mariadb.org/">MariaDB</a> is a fork of MySQL that has <a href="http://kb.askmonty.org/en/mariadb-versus-mysql">additional features</a> and is a drop-in replacement for MySQL. MariaDB is <a href="http://drupal.org/node/861192">supported by Drupal 7</a>, and works with Drupal 6 as well. Make the choice to go with either MariaDB or MySQL and continue; I&rsquo;ll cover how to setup and use both.</p>

<h3>MySQL</h3>

<p>To install MySQL, simply run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install mysql
</span></code></pre></td></tr></table></div></figure>


<p>cmake is a dependency of MySQL, and cmake needs java, so if you get a pop-up asking you to install a Java runtime, be sure to click Install and proceed. Grab a book because compiling MySQL and its dependencies will take several minutes. Now, to configure MySQL (includes raising packet limits for easier use in a non-production scenario) and start:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">unset </span>TMPDIR
</span><span class='line'>mysql_install_db --verbose --user<span class="o">=</span><span class="sb">`</span>whoami<span class="sb">`</span> --basedir<span class="o">=</span><span class="s2">&quot;$(brew --prefix mysql)&quot;</span> --datadir<span class="o">=</span>/usr/local/var/mysql --tmpdir<span class="o">=</span>/tmp
</span><span class='line'>cp <span class="k">$(</span>brew --prefix mysql<span class="k">)</span>/support-files/my-small.cnf /usr/local/var/mysql/my.cnf
</span><span class='line'>sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/max_allowed_packet = 1.*M/max_allowed_packet = 2G/g&#39;</span> /usr/local/var/mysql/my.cnf
</span><span class='line'><span class="o">[</span> ! -d ~/Library/LaunchAgents <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir ~/Library/LaunchAgents
</span></code></pre></td></tr></table></div></figure>


<h3>MariaDB</h3>

<p>To install MariaDB, run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install mariadb pidof
</span></code></pre></td></tr></table></div></figure>


<p><em>pidof</em> is referenced in some of the MariaDB scripts but is not listed as a prerequisite in MariaDB&rsquo;s Homebrew formula, so we need to install it. To configure and start:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">unset </span>TMPDIR
</span><span class='line'>mysql_install_db --verbose --user<span class="o">=</span><span class="sb">`</span>whoami<span class="sb">`</span> --basedir<span class="o">=</span><span class="s2">&quot;$(brew --prefix mariadb)&quot;</span> --datadir<span class="o">=</span>/usr/local/var/mysql --tmpdir<span class="o">=</span>/tmp
</span><span class='line'>cp <span class="k">$(</span>brew --prefix mariadb<span class="k">)</span>/share/mysql/my-small.cnf /usr/local/var/mysql/my.cnf
</span><span class='line'>sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/max_allowed_packet = 1.*M/max_allowed_packet = 2G/g&#39;</span> /usr/local/var/mysql/my.cnf
</span><span class='line'><span class="o">[</span> ! -d ~/Library/LaunchAgents <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir ~/Library/LaunchAgents
</span></code></pre></td></tr></table></div></figure>


<h2>APC and other PECL modules</h2>

<p>PECL modules require compiling, which is why I excluded it from my previous blog post because I did not require Xcode to be installed. An easy one is <strong>uploadprogress</strong> which is often recommended for Drupal development:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo pecl install uploadprogress
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /etc/php.ini &lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'>
</span><span class='line'><span class="s2">; Enable PECL extension uploadprogress </span>
</span><span class='line'><span class="s2">extension=uploadprogress.so </span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>APC is easy too, but requires you to install pcre libraries. With Homebrew, this is easy, and we&rsquo;ll add some basic APC parameters:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install pcre
</span><span class='line'><span class="nv">$ </span>sudo pecl install apc
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /etc/php.ini &lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'>
</span><span class='line'><span class="s2">; Enable PECL extension APC </span>
</span><span class='line'><span class="s2">extension=apc.so </span>
</span><span class='line'><span class="s2">apc.enabled = 1 </span>
</span><span class='line'><span class="s2">apc.shm_segments = 1 </span>
</span><span class='line'><span class="s2">apc.shm_size = 96M </span>
</span><span class='line'><span class="s2">apc.cache_by_default = 1 </span>
</span><span class='line'><span class="s2">apc.stat = 1 </span>
</span><span class='line'><span class="s2">apc.rfc1867 = 1 </span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Non-PECL extensions, like mcrypt, require some additional work. Check out <a href="http://blog.rogeriopvl.com/archives/php-mcrypt-in-snow-leopard-with-homebrew/">this guide for building mcrypt</a>.</p>

<h2>Make PHP and MariaDB / MySQL Play Nice</h2>

<p>If you were to run <code>php -i|egrep 'mysql.*default_socket'</code> you would see that PHP was compiled to expect the MySQL socket file in /var/mysql, but MariaDB / MySQL will place it in /tmp. This easiest fix is to tell PHP to look in /tmp:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s|/var/mysql/mysql\.sock|/tmp/mysql.sock|g&#39;</span> /etc/php.ini
</span></code></pre></td></tr></table></div></figure>


<p>Toggle <strong>Web Sharing</strong> in <strong>System Preferences &gt; Sharing</strong> for the new PHP options to take effect.</p>

<h2>Hooray!</h2>

<p>You should now be all set to keep adding more VirtualHosts in httpd-vhosts.conf and begin development on your local machine. Stay tuned for instructions on how to use <a href="http://www.macports.org/">MacPorts</a>!</p>

<p><strong>Update:</strong> If you&rsquo;re interested in leveraging more from Homebrew, like replacing Apache and PHP all from Homebrew, check out the <a href="https://github.com/adamv/homebrew-alt">homebrew-alt repository</a> on GitHub. Newer versions of Homebrew allow you to install formulae from URLs or alternate folders, and homebrew-alt provides formulae that replace built-in OS X applications (something official formulae will not do). For example, you could install PHP with PHP-FPM, something the OS X-provided PHP does not offer. Have fun exploring!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/24/os-x-107-lion-development-native-mamp-mysql-installer/">OS X 10.7 Lion Development: Native MAMP With MySQL Installer</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-24T15:30:00-04:00" pubdate data-updated="true">Aug 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With the release of Lion, there are some subtle differences to setting up a local MAMP (Mac OS X, Apache, MySQL, PHP) environment compared to Snow Leopard. In an effort to keep this from being overly wordy and just get to the good stuff, we&rsquo;ll dive right in, so read on to get started.</p>

<p>Note that for all commands before that are starting with a $, the dollar sign is showing a command-line prompt in <a href="http://www.apple.com/macosx/apps/all.html#terminal">Terminal</a>, and you should not actually type it as part of the commands.</p>

<h2>Apache</h2>

<p>We&rsquo;ll set things up so we won&rsquo;t need sudo often in the future, and so we can manage multiple VirtualHosts. We&rsquo;ll keep the Apache information and our website roots in ~/Sites, and Apache logs in ~/Sites/logs</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="o">[</span> ! -d ~/Sites <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir ~/Sites
</span><span class='line'><span class="nv">$ </span>touch ~/Sites/httpd-vhosts.conf
</span><span class='line'><span class="nv">$ </span>sudo ln -s ~/Sites/httpd-vhosts.conf /etc/apache2/other
</span><span class='line'><span class="nv">$ </span>mkdir ~/Sites/logs
</span><span class='line'><span class="nv">$ </span>chmod 0777 ~/Sites/logs
</span></code></pre></td></tr></table></div></figure>


<p>Edit the new <strong>~/Sites/httpd-vhosts.conf</strong> file and add the following. Note that you&rsquo;ll need to change all instances of &ldquo;/Users/name&rdquo; to your actual home folder path.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='apache'><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Use name-based virtual hosting. </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="nb">NameVirtualHost</span> *:80
</span><span class='line'>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Set up permissions for VirtualHosts in ~/Sites </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="nt">&lt;Directory</span> <span class="s">&quot;/Users/name/Sites&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nb">Options</span> Indexes FollowSymLinks MultiViews
</span><span class='line'>    <span class="nb">AllowOverride</span> <span class="k">All</span>
</span><span class='line'>    <span class="nb">Order</span> allow,deny
</span><span class='line'>    <span class="nb">Allow</span> from <span class="k">all</span>
</span><span class='line'><span class="nt">&lt;/Directory&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># For http://localhost in the OS X default location </span>
</span><span class='line'><span class="nt">&lt;VirtualHost</span> <span class="s">_default_:80</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nb">ServerName</span> localhost
</span><span class='line'>    <span class="nb">DocumentRoot</span> <span class="sx">/Library/WebServer/Documents</span>
</span><span class='line'><span class="nt">&lt;/VirtualHost&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># VirtualHosts below </span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'>
</span><span class='line'><span class="c">## Template </span>
</span><span class='line'><span class="c">#&lt;VirtualHost *:80&gt; </span>
</span><span class='line'><span class="c">#    ServerName domain.local </span>
</span><span class='line'><span class="c">#    CustomLog &quot;/Users/name/Sites/logs/domain.local-access_log&quot; combined </span>
</span><span class='line'><span class="c">#    ErrorLog &quot;/Users/name/Sites/logs/domain.local-error_log&quot; </span>
</span><span class='line'><span class="c">#    DocumentRoot &quot;/Users/name/Sites/domain.local&quot; </span>
</span><span class='line'><span class="c">#&lt;/VirtualHost&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Launch <strong>System Preferences</strong> and go to <strong>Sharing</strong> and toggle <strong>Web Sharing</strong> off and on so it&rsquo;s started and reloaded with the new settings. Then click on the blue underlined link under <em>&ldquo;Your computer&rsquo;s website is available at this address:&rdquo;</em> to ensure Apache is working correctly, and you should see text saying &ldquo;It works!&rdquo;</p>

<p>To add a site, duplicate the &lt;VirtualHost&gt; section under the Template, remove the comments, and edit appropriately. Edit /etc/hosts (or use <a href="http://code.google.com/p/gmask/">Gas Mask</a>) and add an entry for 127.0.0.1 for your project.local, and make the appropriate change in the conf file, along with the correct DocumentRoot and Log file locations. See <a href="http://httpd.apache.org/docs/2.2/vhosts/name-based.html">Apache&rsquo;s documentation</a> for more information.</p>

<h2>PHP</h2>

<p>OS X has shipped with PHP for quite some time, but not had it enabled by default. We&rsquo;ll enable mod_php for Apache, and also set up an /etc/php.ini file based on the default one shipped with Lion with some development-friendly changes. Change your timezone as needed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo bash -c <span class="s2">&quot;grep php /etc/apache2/httpd.conf|grep LoadModule|cut -d&#39;#&#39; -f2 &gt; /etc/apache2/other/php5-loadmodule.conf&quot;</span>
</span><span class='line'><span class="nv">$ </span>sudo cp -a /etc/php.ini.default /etc/php.ini
</span><span class='line'><span class="nv">$ </span>sudo bash -c <span class="s2">&quot;cat &gt;&gt; /etc/php.ini &lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s2">;; </span>
</span><span class='line'><span class="s2">;; User customizations below </span>
</span><span class='line'><span class="s2">;; </span>
</span><span class='line'>
</span><span class='line'><span class="s2">; Original - memory_limit = 128M </span>
</span><span class='line'><span class="s2">memory_limit = 196M </span>
</span><span class='line'><span class="s2">; Original - post_max_size = 8M </span>
</span><span class='line'><span class="s2">post_max_size = 200M </span>
</span><span class='line'><span class="s2">; Original - upload_max_filesize = 2M </span>
</span><span class='line'><span class="s2">upload_max_filesize = 100M </span>
</span><span class='line'><span class="s2">; Original - default_socket_timeout = 60 </span>
</span><span class='line'><span class="s2">default_socket_timeout = 600 </span>
</span><span class='line'><span class="s2">; Original - max_execution_time = 30 </span>
</span><span class='line'><span class="s2">max_execution_time = 300 </span>
</span><span class='line'><span class="s2">; Original - max_input_time = 60 </span>
</span><span class='line'><span class="s2">max_input_time = 600 </span>
</span><span class='line'><span class="s2">; Original - display_errors = Off </span>
</span><span class='line'><span class="s2">display_errors = on </span>
</span><span class='line'><span class="s2">; Original - display_startup_errors = Off </span>
</span><span class='line'><span class="s2">display_startup_errors = on </span>
</span><span class='line'><span class="s2">; Original - ;date.timezone = </span>
</span><span class='line'><span class="s2">date.timezone = &#39;America/New_York&#39; </span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Optional:</strong> Lion ships with PEAR but not installed, whereas Snow Leopard it was installed. This will install PEAR from the phar archive, upgrade it, and add <code>pear</code> and <code>pecl</code> aliases to your shell.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /usr/bin/php /usr/lib/php/install-pear-nozlib.phar
</span><span class='line'><span class="nv">$ </span>cat &gt;&gt; ~/.bashrc <span class="s">&lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'>
</span><span class='line'><span class="s">alias pear=&quot;php /usr/lib/php/pear/pearcmd.php&quot; </span>
</span><span class='line'><span class="s">alias pecl=&quot;php /usr/lib/php/pear/peclcmd.php&quot; </span>
</span><span class='line'><span class="s">EOF</span>
</span><span class='line'><span class="nv">$ </span>. ~/.bashrc
</span><span class='line'><span class="nv">$ </span>sudo pear channel-update pear.php.net
</span><span class='line'><span class="nv">$ </span>sudo pecl channel-update pecl.php.net
</span><span class='line'><span class="nv">$ </span>sudo pear upgrade --force pear
</span><span class='line'><span class="nv">$ </span>sudo pear upgrade
</span><span class='line'><span class="nv">$ </span>sudo pecl upgrade
</span><span class='line'><span class="nv">$ </span>sudo sh -c <span class="s2">&quot;cat &gt;&gt; /etc/php.ini &lt;&lt;&#39;EOF&#39; </span>
</span><span class='line'><span class="s2">; Original - ;include_path = &quot;</span>.:/php/includes<span class="s2">&quot; </span>
</span><span class='line'><span class="s2">include_path = &quot;</span>.:/usr/lib/php/pear<span class="s2">&quot; </span>
</span><span class='line'><span class="s2">EOF&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that installing most pecl modules will require having a compiler installed via Xcode. I&rsquo;ll be addressing installing <a href="http://pecl.php.net/package/uploadprogress">uploadprogress</a> and <a href="http://pecl.php.net/package/apc">APC</a> in a later post, since this walkthrough requires no compiling.</p>

<p>Toggle <strong>Web Sharing</strong> in <strong>System Preferences &gt; Sharing</strong> for the new PHP options to take effect.</p>

<h2>MySQL</h2>

<p>MySQL is the only thing not shipped with OS X that we need for our development environment. Go to the download site for OS X pre-built binaries at <a href="http://dev.mysql.com/downloads/mysql/index.html#macosx-dmg">http://dev.mysql.com/downloads/mysql/index.html#macosx-dmg</a> and choose the <strong>DMG Archive</strong> most appropriate for your system. As of this writing, the most recent version says <em>OS X 10.6</em>, but it will work on 10.7 as well.</p>

<p>Open the downloaded disk image and begin by installing the <em>mysql-5.x.x-osx10.6-x86_64.pkg</em> file. Once the Installer script is completed, install the Preference Pane by double-clicking on MySQL.prefPane. If you are not sure where to install the preference pane, choose &ldquo;Install for this user only.&rdquo;</p>

<p><strong>Optional:</strong> If you wish to have MySQL start on boot, you do need to additionally install the MySQLStartupItem.pkg file. The preference pane has a toggle for starting on boot, but it will not work until you install the pkg and you run the following in Terminal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo chown -R root:wheel /Library/StartupItems/MySQLCOM
</span></code></pre></td></tr></table></div></figure>


<p>Open <strong>System Preferences</strong> and <strong>MySQL</strong> and start the database by clicking the <strong>Start MySQL Server</strong> button.</p>

<p><strong>Optional:</strong> The MySQL installer installed its files to /usr/local/mysql, and the binaries are in /usr/local/mysql/bin which is not in the $PATH of any user by default. Rather than edit the $PATH shell variable, we add symbolic links in /usr/local/bin (a location already in $PATH) to a few MySQL binaries. Add more or omit more binaries as desired:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span> ! -d /usr/local/bin <span class="o">]</span> <span class="o">&amp;&amp;</span> sudo mkdir -p /usr/local <span class="o">&amp;&amp;</span> sudo chmod 0777 /usr/local <span class="o">&amp;&amp;</span> mkdir /usr/local/bin <span class="o">&amp;&amp;</span> sudo chmod 0755 /usr/local
</span><span class='line'><span class="nb">cd</span> /usr/local/bin
</span><span class='line'>ln -s /usr/local/mysql/bin/mysql
</span><span class='line'>ln -s /usr/local/mysql/bin/mysqladmin
</span><span class='line'>ln -s /usr/local/mysql/bin/mysqldump
</span><span class='line'>ln -s /usr/local/mysql/support-files/mysql.server
</span></code></pre></td></tr></table></div></figure>


<p>This script ships with MySQL and only needs to be run once, and it should be run with sudo. As you run it, you can accept all other defaults after you set the root user&rsquo;s password:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo /usr/local/mysql/bin/mysql_secure_installation
</span></code></pre></td></tr></table></div></figure>


<p>After installing MySQL, several sample my.cnf files are created but none is placed where MySQL can find it. Start with a &ldquo;small&rdquo; configuration file and make a few changes to increase the max_allowed_packet variable:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo cp /usr/local/mysql/support-files/my-small.cnf /usr/local/mysql/data/my.cnf
</span><span class='line'>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/max_allowed_packet = 1.*M/max_allowed_packet = 2G/g&#39;</span> /usr/local/mysql/data/my.cnf
</span></code></pre></td></tr></table></div></figure>


<p>To load in these changes, go back to the MySQL System Preferences pane, and restart the server by pressing &ldquo;Stop MySQL Server&rdquo; followed by &ldquo;Start MySQL Server.&rdquo;</p>

<h2>Make PHP and MySQL Play Nice</h2>

<p>If you were to run <code>php -i|egrep 'mysql.*default_socket'</code> you would see that PHP was compiled to expect the MySQL socket file in /var/mysql, but MySQL will place it in /tmp. This easiest fix is to tell PHP to look in /tmp:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo sed -i <span class="s2">&quot;&quot;</span> <span class="s1">&#39;s/\/var\/mysql\/mysql\.sock/\/tmp\/mysql\.sock/g&#39;</span> /etc/php.ini
</span></code></pre></td></tr></table></div></figure>


<p>Toggle <strong>Web Sharing</strong> in <strong>System Preferences &gt; Sharing</strong> for the new PHP options to take effect.</p>

<h2>Hooray!</h2>

<p>You should now be all set to keep adding more VirtualHosts in httpd-vhosts.conf and begin development on your local machine. Stay tuned for instructions on how to use <a href="http://mariadb.org/">MariaDB</a> or MySQL with <a href="http://mxcl.github.com/homebrew/">Homebrew</a> instead of the Oracle MySQL installer, and <a href="http://www.macports.org/">MacPorts</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/17/use-syslog-instead-watchdog/">Use Syslog Instead of Watchdog</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-17T16:02:00-04:00" pubdate data-updated="true">Aug 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this example, we choose one of our servers to receive the Syslog traffic and the others will send traffic to it. In a large environment, you should use a non-public-facing server to act as a syslog server for your sites, ideally using a database to store data, but we&rsquo;ll just output everything to a file to keep things simple for this guide. If you decide to use a database like MySQL to store your data, this can still provide you with a starting point, but just know that using your same production database server defeats my intended purpose since I was ultimately trying to alleviate the amount of writes on the database.</p>

<p>Start by using yum to install <strong>rsyslog</strong>. If you&rsquo;re using another distro, rsyslog is likely included in the base repositories. Also, note that CentOS 6 uses rsyslog by default so you may skip this step if it&rsquo;s already installed on your system. You&rsquo;ll need this on all servers running Drupal or your rsyslog server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum install rsyslog
</span></code></pre></td></tr></table></div></figure>


<p>For CentOS 5, you&rsquo;ll need to unload the default syslog and switch to rsyslog. The following will ensure it starts on boot as well. Until otherwise noted, run the following commands on all servers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/sbin/service syslog stop <span class="o">&amp;&amp;</span> /sbin/service rsyslog start
</span><span class='line'>/sbin/chkconfig rsyslog on
</span><span class='line'>/sbin/chkconfig syslog off
</span></code></pre></td></tr></table></div></figure>


<p>Rather than hacking the config file to bits, I find it easier to create an include folder and keep things organized by files. I also like to back up default files created by RPMs so if an update leaves behind rsyslog.rpmnew, you can compare it to the default to see the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -v /etc/rsyslog.d
</span><span class='line'>cp -av /etc/rsyslog.conf<span class="o">{</span>,-default<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add the following to <strong>/etc/rsyslog.conf</strong> below the last line containing &ldquo;$ModLoad&rdquo;:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Include all files in /etc/rsyslog.d</span>
</span><span class='line'><span class="nv">$IncludeConfig</span> /etc/rsyslog.d/*.conf
</span></code></pre></td></tr></table></div></figure>


<p>Reload the current rsyslog configuration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/sbin/service rsyslog reload
</span></code></pre></td></tr></table></div></figure>


<p>The next several steps will only need to be run on the syslog server. Back up and edit <strong>/etc/sysconfig/rsyslog</strong> to accept UDP connections from other servers. If you&rsquo;re using iptables, open up port 514 on UDP.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cp -a /etc/sysconfig/rsyslog /etc/sysconfig/rsyslog-default
</span></code></pre></td></tr></table></div></figure>


<p>Edit /etc/sysconfig.rsyslog and change <strong>SYSLOGD_OPTIONS=&ldquo;-m 0&rdquo;</strong> to <strong>SYSLOGD_OPTIONS=&ldquo;-m 0 -r514&rdquo;</strong></p>

<p>Create a root folder for website logs to go:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir /var/log/websites
</span></code></pre></td></tr></table></div></figure>


<p>Create the following file to work with example.com (this format will allow you to create other files for anotherexample.org, etc.): <strong>/etc/rsyslog.d/example.conf</strong>. Add the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># example.com</span>
</span><span class='line'><span class="nv">$template</span> DailyPerHostLogs-example,<span class="s2">&quot;/var/log/websites/%SYSLOGTAG:F,58:1%/%SYSLOGTAG:F,58:1%.%$YEAR%-%$MONTH%-%$DAY%.log&quot;</span>
</span><span class='line'>:syslogtag, contains, <span class="s2">&quot;example&quot;</span>                    -?DailyPerHostLogs-example
</span><span class='line'>&amp; ~
</span></code></pre></td></tr></table></div></figure>


<p>This will create <strong>/var/log/websites/example/example.2011-08-17.log</strong> and new files for each day. To add other websites, duplicate the file and replace example with another string. We&rsquo;ll later use &ldquo;example&rdquo; in the Drupal configuration for Syslog later that will correlate to the correct file.</p>

<p>For those curious about this configuration: a template is needed for dynamic file paths with year-month-day. The syslogtag variable will use the string sent by Drupal in the Syslog module settings. Drupal will send it as <strong>example:</strong>, so <em>:F,58:1</em> will use the colon as the field separator and grab the first field. Even though it would appear as though this single template could be used on multiple sites, I found I still had to have a unique template for each website or all websites would dump into the same file (perhaps this is remedied in newer versions of rsyslog). The last line means that the syslog input will not be sent to any other syslog files.</p>

<p>Reload the current rsyslog configuration, and the server is set up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/sbin/service rsyslog reload
</span></code></pre></td></tr></table></div></figure>


<p>On the clients, we&rsquo;ll create simple .conf files for each website. Create <strong>/etc/rsyslog.d/example.conf</strong> on each additional web server containing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># example.com</span>
</span><span class='line'>:syslogtag, contains, <span class="s2">&quot;example&quot;</span>     @192.168.1.20
</span></code></pre></td></tr></table></div></figure>


<p>Note that the IP address can also be a domain name, though I would not recommend it to keep another process from being needed for the lookup.</p>

<p>Reload the current rsyslog configuration, and each web client is set up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/sbin/service rsyslog reload
</span></code></pre></td></tr></table></div></figure>


<p>Enable the syslog module and go to <strong><a href="http://example.com/admin/settings/logging/syslog**.">http://example.com/admin/settings/logging/syslog**.</a> Set the Syslog Identity to match the value used in /etc/rsyslog.d/example.conf; in this case, </strong>example**. Using the rsyslog filter we&rsquo;re using, it does not matter which facility we send to. Save the configuration.</p>

<p><img src="http://echoditto.com/sites/default/files/rsyslog-screenshot.png" alt="rsyslog-screenshot" /></p>

<p>Go to your rsyslog server and watch the <strong>/var/log/websites/example/example.2011-08-16.log</strong> file. After verifying that the server is receiving all messages, disable the Watchdog module in **<a href="http://example.org/admin/build/modules/list**.">http://example.org/admin/build/modules/list**.</a></p></p>

<p>There are improvements that can be had here, like using TCP instead of UDP, using <a href="http://loganalyzer.adiscon.com">LogAnalyzer</a> to filter through the files, and more. This was meant to be an introduction into getting combined text files of your watchdog output while reducing the strain on your database by not writing to it as often.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/03/25/keep-drush-date/">Keep Drush Up to Date</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-25T17:39:00-04:00" pubdate data-updated="true">Mar 25<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>UPDATE:</strong> See <a href="/blog/2012/08/29/three-ways-get-drush-os-x/">Three Ways to Get Drush on OS X</a> for a newer guide.</p>

<p>At <a href="http://www.echoditto.com">EchoDitto</a>, we&rsquo;re big fans of <a href="http://drupal.org/project/drush">Drush</a>. It&rsquo;s installed on all of our servers and it&rsquo;s a great way to <a href="http://drush.ws/#core-cron">perform maintenance tasks</a>, <a href="http://drush.ws/#pm-download">download core and modules</a>, and <a href="http://www.lullabot.com/articles/drush-make-and-pressflow">much much more</a>. I&rsquo;m not a big fan of installing from zip files though, so let&rsquo;s use git to easily keep our Drush install up to date.</p>

<p>Before <a href="http://www.lullabot.com/blog/git-coming-soon-drupalorg">the git transition</a>, I would use Subversion to check out the latest drush release somewhere, like /usr/local/drush (on my Mac), using the CVS clone <a href="http://dembach.net/subversible/en">Subversible</a>. Today, however, I noticed that the latest tagged release Subversible has is <a href="https://subversible.svn.beanstalkapp.com/modules/drush/tags/">4.2</a>, and the <a href="http://drupal.org/project/drush">Drush project page</a> has 4.4 ready to download. I figured now would be a good time to start using <a href="http://git-scm.com/">git</a> for this and stop relying on a third-party to provide the code for Subversion.</p>

<p>The commands below will walk through cloning the Drush git repository and then switching to the latest release. I realize the <a href="http://drush.ws/#self-update">drush self-update</a> will soon make this irrelevant, but this method works today and is a great exercise in learning how Drupal is using git, especially important coming from Subversion.</p>

<p>Clone the repository. It will create the subfolder &ldquo;drush&rdquo; from your current working directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone --branch master http://git.drupal.org/project/drush.git
</span><span class='line'><span class="nb">cd </span>drush
</span></code></pre></td></tr></table></div></figure>


<p>Use pear to download <em>includes/table.inc</em>. This one-liner will take care of everything for you as long as you have pear installed and are in the new drush directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pear download Console_Table
</span><span class='line'>tar zxvf <span class="sb">`</span>ls Console_Table-*.tgz<span class="sb">`</span> <span class="sb">`</span>ls Console_Table-*.tgz | sed -e <span class="s1">&#39;s/\.[a-z]\{3\}$//&#39;</span><span class="sb">`</span>/Table.php
</span><span class='line'>mv <span class="sb">`</span>ls Console_Table-*.tgz | sed -e <span class="s1">&#39;s/\.[a-z]\{3\}$//&#39;</span><span class="sb">`</span>/Table.php includes/table.inc
</span><span class='line'>chmod 0644 includes/table.inc <span class="o">&amp;&amp;</span> rm -fr Console_Table-*
</span></code></pre></td></tr></table></div></figure>


<p>At this point you may or may not have a functioning Drush installation, because you&rsquo;re using the HEAD of the Drush code repository and it might contain broken code. I would recommend switching the checkout to the latest release. We&rsquo;ll start by viewing all releases:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git tag
</span><span class='line'>5.x-1.0
</span><span class='line'>5.x-1.0-beta1
</span><span class='line'>5.x-1.0-beta2
</span><span class='line'>... snip ...
</span><span class='line'>7.x-4.2
</span><span class='line'>7.x-4.3
</span><span class='line'>7.x-4.4
</span><span class='line'>debian/4.3-1
</span><span class='line'>debian/4.4-1
</span></code></pre></td></tr></table></div></figure>


<p>As of this writing, there are over 50 results from this command, but you&rsquo;ll see the latest is &ldquo;7.x-4.4&rdquo;. If we want our local Drush install to be at 4.4, change the checkout:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git checkout 7.x-4.4
</span><span class='line'>Previous HEAD position was 1532d0c... <span class="c">#1079434 by msonnabaum. Add .gitignore for includes/table.inc</span>
</span><span class='line'>HEAD is now at a808ff0... Updating drush version
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it! Drush is set up on 4.4:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>drush --version
</span><span class='line'>drush version 4.4
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s say 4.5 is released tomorrow and you want to change your checkout. First you&rsquo;ll need to update the local git repository: <code>git pull</code></p>

<p>View the list of tags:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git tag
</span><span class='line'>5.x-1.0
</span><span class='line'>5.x-1.0-beta1
</span><span class='line'>5.x-1.0-beta2
</span><span class='line'>... snip ...
</span><span class='line'>7.x-4.3
</span><span class='line'>7.x-4.4
</span><span class='line'>7.x-4.5
</span><span class='line'>debian/4.3-1
</span><span class='line'>debian/4.4-1
</span><span class='line'>debian/4.5-1
</span></code></pre></td></tr></table></div></figure>


<p>And switch your checkout to the new release: <code>git checkout 7.x-4.5</code></p>

<p>Repeat for future releases, and enjoy! Of course, once <a href="http://drush.ws/#self-update">drush self-update</a> begins working, that will be the preferred method, but this will work today. Please questions or comments below.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/02/22/dump-each-mysql-table-file/">Dump Each MySQL Table to a File</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-22T14:30:00-05:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here&rsquo;s a one-liner to dump each table in a database to it&rsquo;s own .sql file. Crack open your shell of choice and follow along.</p>

<p>Replace the USER, PASSWORD, and DBNAME values with your own. If you&rsquo;re not running this to connect to a local database, add &mdash;host=domain.tld after each password to connect to your remote server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for i in $(mysql -uUSER -p'PASSWORD' --batch --skip-column-names DBNAME -e'show tables;'); do mysqldump -uUSER -p'PASSWORD' DBNAME $i &gt; DBNAME-$i.sql; done</span></code></pre></td></tr></table></div></figure>


<p>Users, passwords, and database names are case sensitive, I made them uppercase here to call them out. Leave a comment if you have a question or notice a problem or typo.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/02/15/fix-pear-permissions-problem-mac-os-x/">Fix Pear Permissions Problem on Mac OS X</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-15T16:34:00-05:00" pubdate data-updated="true">Feb 15<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>On Snow Leopard, you can install drush without using sudo. A dependency for installing drush is downloading a Pear library. The following example should allow you to be able to use the following commands to install drush to /usr/local/drush with a symlink in /usr/local/bin/drush, but it fails on the &lsquo;pear download&rsquo; step, even though it&rsquo;s writing to a user-writeable directory. Read on the figure out how to fix this annoying problem.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>svn co http://subversible.svn.beanstalkapp.com/modules/drush/tags/DRUPAL-7--4-2/ /usr/local/drush 
</span><span class='line'>cd /tmp 
</span><span class='line'>pear download Console_Table 
</span><span class='line'>tar zxvf `ls Console_Table-*.tgz` `ls Console_Table-*.tgz | sed -e 's/\.[a-z]\{3\}$//'`/Table.php 
</span><span class='line'>mv `ls Console_Table-*.tgz | sed -e 's/\.[a-z]\{3\}$//'`/Table.php 
</span><span class='line'>/usr/local/drush/includes/table.inc $ rm -fr Console_Table-* 
</span><span class='line'>ln -s /usr/local/drush/drush /usr/local/bin/drush</span></code></pre></td></tr></table></div></figure>


<p>This assumes 1) /usr/local exists and you can write to it, and 2) you&rsquo;ve added the following to your ~/.profile (or ~/.bashrc or ~/.bash_profile):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Use the built-in PEAR and PECL scripts
</span><span class='line'>alias pear="/usr/bin/php /usr/lib/php/pearcmd.php"
</span><span class='line'>alias pecl="/usr/bin/php /usr/lib/php/peclcmd.php"</span></code></pre></td></tr></table></div></figure>


<p>But, OS X has a strange permissions problem when using pear for the first time. Running &lsquo;pear download&rsquo; should not require sudo, but if you&rsquo;ve never used pear before you&rsquo;ll get this error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pear download Console_Table 
</span><span class='line'>
</span><span class='line'>Warning: touch(): Unable to create file /usr/lib/php/.lock because Permission denied in PEAR/Registry.php on line 835 
</span><span class='line'>
</span><span class='line'>Warning: touch(): Unable to create file /usr/lib/php/.lock because Permission denied in /usr/lib/php/PEAR/Registry.php on line 835 
</span><span class='line'>could not create lock file: fopen(/usr/lib/php/.lock): failed to open stream: No such file or directory 
</span><span class='line'>invalid package name/package file "Console_Table" 
</span><span class='line'>download failed</span></code></pre></td></tr></table></div></figure>


<p>Strange, right? Administrators in OS X are in the wheel group, but /usr/lib/php is not writable by the group. Before you go changing permissions (which might not be retained after an OS X update), all you have to do is run something as root with pear:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pear list
</span><span class='line'>Installed packages, channel pear.php.net:
</span><span class='line'>=========================================
</span><span class='line'>Package          Version State
</span><span class='line'>Archive_Tar      1.3.3   stable
</span><span class='line'>Console_Getopt   1.2.3   stable
</span><span class='line'>PEAR             1.8.0   stable
</span><span class='line'>Structures_Graph 1.0.2   stable
</span><span class='line'>XML_Util         1.2.1   stable</span></code></pre></td></tr></table></div></figure>


<p>The permissions and ownership of /usr/lib/php are still the same, but there is now the file /usr/lib/php/.lock</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls -Al /usr/lib/php/.lock
</span><span class='line'>-rw-r--r--  1 root  wheel  0 Feb 15 16:08 /usr/lib/php/.lock</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;d think that when pear has completed running the list command it would delete the .lock file, but it doesn&rsquo;t. But since it&rsquo;s there, the original pear download command will now run without sudo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pear download Console_Table
</span><span class='line'>downloading Console_Table-1.1.4.tgz ...
</span><span class='line'>Starting to download Console_Table-1.1.4.tgz (9,369 bytes)
</span><span class='line'>.....done: 9,369 bytes
</span><span class='line'>File /private/tmp/Console_Table-1.1.4.tgz downloaded</span></code></pre></td></tr></table></div></figure>


<p>Of course, running &lsquo;pear install&rsquo; or many other commands will require sudo, but it&rsquo;s silly that commands that do not write any files to /usr/lib/php or its children would require sudo.</p>

<p>Unrelated to the pear permissions issue, but related to my drush install script; this assumes that /usr/local and /usr/local/bin exist. By default, /usr/local/bin is in the $PATH regardless of whether or not the folder exists, but on a vanilla OS X install /usr/local does not exist. I have both Xcode and homebrew installed. I know homebrew will create /usr/local for you, but I&rsquo;m not sure about Xcode. If you don&rsquo;t want to have either installed but want drush installed to /usr/local, run this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mkdir -p /usr/local/bin
</span><span class='line'>sudo chown -R root:wheel /usr/local</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/11/creating-php-packages-software-collection/">Creating PHP Packages as a Software Collection</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/09/speed-up-php-on-nfs-with-turbo-realpath/">Speed Up PHP on NFS With Turbo_realpath</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/17/virtualbox-extension-pack-with-one-line/">VirtualBox Extension Pack With One Line</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/21/real-time-ruby-gem-development/">&#8220;Real-time&#8221; Ruby Gem Development</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/19/usable-mamp-os-x-108-mountain-lion/">Usable MAMP on OS X 10.8 Mountain Lion</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <div>
    <a href="http://coderwall.com/alanthing" target="_blank" class="cw_badge"><img
       alt="Endorse alanthing on Coderwall"
       src="http://api.coderwall.com/alanthing/endorsecount.png" /></a>
  </div>
  

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target),
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" target="_blank" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.html(fragment);
      }
      return {
        showBadges: function(options){
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , dataType: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $(document).ready(function(){
      coderwall.showBadges({
        user: 'alanthing',
        target: '#cw_badges'
      });
    });
  </script>
</section>


<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/alanthing">@alanthing</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'alanthing',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Alan Ivey -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'alanthing';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
